

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; wiki_aE 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interpreting Gaussian" href="gaussian.html" />
    <link rel="prev" title="Welcome to wiki_aE’s documentation!" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> wiki_aE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basics-windows-computer-specifics">Basics: Windows computer specifics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-on-bluecrystal3">Install on BlueCrystal3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-on-bluecrystal3">Run on BlueCrystal3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-on-grendel">Install on Grendel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-on-grendel">Run on Grendel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="#panic-noes-method-to-work-in-tandem-with-auto-enrich">PANIC: NOEs method to work in tandem with auto-ENRICH</a></li>
<li class="toctree-l2"><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gaussian.html">Interpreting Gaussian</a></li>
<li class="toctree-l1"><a class="reference internal" href="gaussian.html#interpreting-bluecrystal">Interpreting BlueCrystal</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="ENRICH.html">ENRICH</a></li>
<li class="toctree-l1"><a class="reference internal" href="ENRICH.html#concept">Concept</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">wiki_aE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>~.. _user_guide:</p>
<div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basics">
<span id="id1"></span><h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p><strong>*Using the command line*</strong></p>
<p>Learn to use the command line, complete the tutorial at <a class="reference external" href="https://www.codecademy.com/learn/learn-the-command-line">https://www.codecademy.com/learn/learn-the-command-line</a></p>
<p>Commands you need to type into your terminal window (after logging in to BlueCrystal) are written in block quotes as below. Notes are preceeded by a #:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>type_this_into_terminal_window
<span class="c1"># Then press enter to run command</span>
<span class="c1"># Helpful extra instructions, do not type this into the terminal window</span>
</pre></div>
</div>
</div></blockquote>
<p>Must learn basic unix commands,</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">pwd</span>
<span class="c1"># prints the current folder you&#39;re in</span>
ls
<span class="c1"># List folders in your current directory (directory is a fancier name for folder)</span>
<span class="nb">cd</span> folder_name
<span class="c1"># Moves you into the folder called folder_name (assuming that in your current directory)</span>
</pre></div>
</div>
</div></blockquote>
<p>When you run the later commands you need to make sure you’re running them from a particular folder you’ve set up for the molecules</p>
<p><strong>*Vim*</strong></p>
<p>Learn to use Vim, complete the tutorial at <a class="reference external" href="https://www.openvim.com/">https://www.openvim.com/</a> before continuing</p>
<p><strong>*Further Notes*</strong></p>
<p>auto-ENRICH is a set of python scripts to assist you in extracting and computing NMR parameters and conformer energies from molecular mechanics results using Gaussian. Find out what Gaussian is if you don’t know.</p>
<p>BlueCrystal is a computing cluster. A room full of computers you can get to do calculations for you. We make Gaussian input files (.com files) specifying a certain thing we want Gaussian to do then submit them to BlueCrystal for random computers in the BlueCrystal to run and give back the answers. For reference your computer (probably) has 4 cores, on BlueCrystal you can sometimes use up to 400 cores at once. Running DFT is computationally very expensive so doing it on your personal laptop would take forever - hence we use BlueCrystal.</p>
<p>We’d recommend you use Maestro (the free academic license version, most up to date version please) to view molecules. The .xyz files generated in some of auto-ENRICH should be draggable directly into Maestro to view.</p>
</div>
<div class="section" id="basics-windows-computer-specifics">
<h2>Basics: Windows computer specifics<a class="headerlink" href="#basics-windows-computer-specifics" title="Permalink to this headline">¶</a></h2>
<p><strong>*WinSCP*</strong></p>
<p>Open WinSCP – This lets you transfer files from your area to BlueCrystal and vice versa.
i.      Host name: grendel.chm.bris.ac.uk
ii.     Username: UOB username
iii.    Save settings and Login
iv.     When prompted log in with your UOB username and BlueCrystal password
v.      You can then use the save session the next time you open WinSCP to avoid entering the host name again</p>
<p><strong>*PuTTY*</strong></p>
<p>Open PuTTY – This lets you interact with BlueCrystal via a terminal.
i.      Host Name: grendel.chm.bris.ac.uk
ii.     Modify setting: Connection – SSH – X11 – Yes to Enable X11 Forwarding
iii.    Save settings in the “Session” tab
iv.     Login as: UOB username
v.      Type in your BlueCrystal password when prompted (the password won’t be displayed onscreen)
vi.     You can then use the saved session the next time you open WinSCP to avoid entering the host name again</p>
<p>When we say ‘log in’ to BlueCrystal we will mean using PuTTY</p>
</div>
<div class="section" id="install-on-bluecrystal3">
<span id="install-bc3"></span><h2>Install on BlueCrystal3<a class="headerlink" href="#install-on-bluecrystal3" title="Permalink to this headline">¶</a></h2>
<p><strong>0</strong> Get IT to allow you to use Gaussian on BlueCrystal, email <a class="reference external" href="mailto:hpc-help&#37;&#52;&#48;bristol&#46;ac&#46;uk">hpc-help<span>&#64;</span>bristol<span>&#46;</span>ac<span>&#46;</span>uk</a> asking them to set up and give your account access to use Gaussian</p>
<p><strong>1</strong> Get access to auto-ENRICH by creating an account on GitHub.com (free one, obviously) then email your GitHub username (and ask for access to auto-ENRICH) to <a class="reference external" href="mailto:will&#46;gerrard&#37;&#52;&#48;bristol&#46;ac&#46;uk">will<span>&#46;</span>gerrard<span>&#64;</span>bristol<span>&#46;</span>ac<span>&#46;</span>uk</a></p>
<p><strong>2</strong> Set up your environment:</p>
<blockquote>
<div><p><strong>2.0</strong> Log in to BlueCrystal and move to your home directory</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
<span class="c1"># This moves you to your home directory, this is basic unix command line, please learn.</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1</strong> Load the conda package. This allows you to easily import modules (packs of pre-built code from other people) into Python (the programming language) to use.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load languages/python-anaconda-5.0.1-2.7
<span class="c1"># You can copy and paste these commands rather than slowly typing them out BUT only one line at a time (to execute each command separately)</span>
<span class="c1"># Note if on Windows using PuTTY terminal: paste is right clicking inside the PuTTY window not by pressing Ctrl-V like you normally would</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.2</strong> Create an environment (Basically just a list of the modules we want to use, The piece of software we use Anaconda (conda for short) will load them every time you activate that environment) using Anaconda. We’re going to name the environment ‘myenv’ for simplicity</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create --name myenv
<span class="c1"># Press y (and sometimes enter if it hasn&#39;t done anything) when things ask you if you want to do the command you&#39;ve just asked to do.</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.3</strong> Install modules to the environment we just created. We want to install openbabel and numpy. Numpy and SciPy are python modules that allows us maths easily in Python, while OpenBabel is a chemistry related module. The auto-ENRICH scripts use these modules.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install -c openbabel -n myenv openbabel
conda install -n myenv numpy scipy
</pre></div>
</div>
</div></blockquote>
<p><strong>2.4</strong> Activate the environment you just made, this should put add “(myenv)” to the far left of where you input commands</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> activate myenv
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>3</strong> Set up Github and get a copy of auto-ENRICH:</p>
<blockquote>
<div><blockquote>
<div><p><strong>3.1</strong> On BlueCrystal: Find your ssh key, we do this by first going to your home folder in BlueCrystal then opening .ssh/id_dsa.pub (a text file) containing your key. vim is a very simple text editing package, you should know how to use it, if not please search vim and learn.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim ~/.ssh/id_dsa.pub
<span class="c1"># vim bit at the start means use vim (text editing package) to open the file ~/blah. The ~/ is unix command line shorthand for your &#39;root&#39; directory (the one you move to when you cd, it&#39;s basically your home folder. If you don&#39;t know what cd does, please go back to start and do a unix command line tutorial).</span>
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="_images/sshkey.png" src="_images/sshkey.png" />
<p class="caption"><span class="caption-text">Example ssh key</span></p>
</div>
</div></blockquote>
<p><strong>3.2</strong> Copy the key (all that text) then exit vim</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy the key...</span>
<span class="c1"># If using Windows and are using PuTTY then highlighting and right click will copy the text</span>
<span class="c1"># Press the Esc key</span>
:q!
<span class="c1"># Closes file (without editing), this is basic use of vim, you should understand this.</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3</strong> On Normal Computer: Login to Github.com (after making an account) then go to Settings - SSH and GPG keys - New SSH key and paste the key and give it a simple title like BlueCrystal3. Github is a website that we store our auto-ENRICH code on, by giving it your SSH key we are allowing your BlueCrystal account to access your Github account.</p>
<blockquote>
<div><div class="figure" id="id5">
<img alt="_images/ssh_github.png" src="_images/ssh_github.png" />
<p class="caption"><span class="caption-text">Navigate through github.com to input ssh key</span></p>
</div>
</div></blockquote>
<p><strong>3.4</strong> On BlueCrystal: Enable git</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load tools/git-2.18.0
</pre></div>
</div>
</div></blockquote>
<p><strong>3.5</strong> Copy the auto-ENRICH files, it’ll make a folder called auto-ENRICH containing all the files.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recurse-submodules -b release_1 git@github.com:wg12385/auto-ENRICH.git
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>Note</strong> We’ve done all this rather than just copying a folder ‘normally’ to your BlueCrystal account because Github is special. If auto-ENRICH is updated to fix bugs and add functionality you can update your version by cd’ing into the auto-ENRICH folder and typing:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Double check you&#39;re actually in your auto-ENRICH folder, use &#39;pwd&#39; to double check (basic unix command line, please learn.) then</span>
git pull --recurse-submodules -b  origin release_1
<span class="c1"># This pulls the version of auto-ENRICH from GitHub we have called release_1 (You don&#39;t need to know about the recurse submodules bit)</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>4</strong> Get BlueCrystal to automatically set up things for auto-ENRICH every time you log in BlueCrystal.</p>
<blockquote>
<div><p><strong>4.1</strong> Open ~/.bashrc, this is a script that runs automatically when you log in to BlueCrystal3 (Just a unix command line thing, nothing to do with auto-ENRICH)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim ~/.bashrc
<span class="c1"># Open the .bashrc file in vim (text editor)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2</strong> Tell BlueCrystal to automatically load python and Git and then activate your conda environment every time you log in by adding the following lines to .bashrc (file you just opened) at the bottom</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>i key<span class="o">)</span>
<span class="c1"># pressing i key allows you to edit files in vim, you should know this, if you don&#39;t, look up a vim tutorial</span>

<span class="c1">#Add following lines to the file (at the bottom)</span>
module load languages/python-anaconda-5.0.1-2.7
module load tools/git-2.18.0
<span class="nb">source</span> activate myenv

<span class="c1"># then exit vim, writing your changes to the file. Esc key exits the edit mode. The w is write, q is quit.</span>
<span class="o">(</span>Esc key<span class="o">)</span>
:wq
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-on-bluecrystal3">
<span id="run-bc3"></span><h2>Run on BlueCrystal3<a class="headerlink" href="#run-on-bluecrystal3" title="Permalink to this headline">¶</a></h2>
<p>auto-ENRICH automates moving from a conformational search output to getting out NMR parameters. Save the output of your conformational search to one .xyz file (that contains lots of conformers) for a particular molecule. We want to make a folder for each molecule which we then run the DFT for.</p>
<p><strong>1</strong> Make a folder with the molecule name and put your .xyz file in it, cd into that folder</p>
<p><strong>2</strong> Copy the preferences file from the auto-ENRICH folder. This is a simple file where you can write all the exact parameters you want to do the DFT with (Functional, Basis set, Grid size, Convergence Criteria, Use of frequency calculation, Redundant conformer elimination options, blah….)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp ~/auto-ENRICH/ENRICH.prefs ./
<span class="c1">#The &#39;cp&#39; is telling unix command line to copy then we put location of file we want to copy (&#39;~/auto-ENRICH/ENRICH.prefs&#39;),</span>
<span class="c1"># and then where we want to copy it to, in this case your current directory (&#39;./&#39;)</span>
<span class="c1"># Again, unix command line tutorial.</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.0</strong> Chat to someone about the parameters you should do your DFT with and find out what all the preferences in the ENRICH.prefs file actually means. Learn what DFT is.</p>
<p><strong>3</strong> Edit the preferences (for this particular molecules DFT), if you want to run all your calculations in a specific way then we suggest you edit ENRICH.prefs in the auto-ENRICH to your own personal preferences to save time in future</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim ENRICH.prefs
<span class="c1"># Press the i key then edit the file</span>

<span class="c1"># After editing...</span>
<span class="c1"># Press the Esc key to exit edit mode</span>
:wq
<span class="c1"># This saves and closes the file, you should have learnt vim.</span>
</pre></div>
</div>
</div></blockquote>
<p>For solvent option it only takes specific words, for example chloroform, dmso, water, toluene, n-hexane (but not cdcl3, this will not run)
If you want to use an odd solvent please consult <a class="reference external" href="http://gaussian.com/scrf/">http://gaussian.com/scrf/</a> -&gt; More -&gt; Solvents where there’s a list</p>
<p><strong>4</strong> (While in folder for your molecule) Create optimisation jobs based on your choices in ENRICH.prefs by running xyz_to_opt.py script and telling it the name of your xyz file, eg if the xyz file was molecule.xyz</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/xyz_to_opt.py molecule.xyz
<span class="c1"># tilde &#39;~&#39; is like ../ but it goes back to your home directory, the one you move to when you type &#39;cd&#39; from any folder on the terminal</span>
</pre></div>
</div>
</div></blockquote>
<p>The script automatically looks and produces com files (Gaussian DFT job submission files) for all the structures in all the xyz files in your current folder</p>
<p>This will produce an optcom folder filled with .com files and .qsub file(‘s)
What auto-ENRICH has done is make a load of input files (for each structure in the .xyz file) for Gaussian to run saying ‘do a geometry optimisation (and then frequency calculation) with this starting structure based on the preferences we put in ENRICH.prefs’
The com files are the just Gaussian input files. The qsub file is so you can submit those gaussian com files as jobs on BlueCrystal.</p>
<p>Please open and look at a couple of the optcom files to see what Gaussian input files look like and that you understand what (most) of the lines of the input file actually means.
Also have a look at the .qsub file, try understand what it’s doing.</p>
<p><strong>5</strong> Submit job files so BlueCrystal will run all the Gaussian submission files you’ve written. .qsub files are named after the .xyz file you started with so the below code is for if you have ‘molecule1.xyz’ as your conformer containing xyz file. If you’ve forgotten the name of your xyz file a simple ‘ls’ in the command window will show you (again basic cmd line unix)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
qsub molecule1_OPT_0.qsub
<span class="c1">#If you&#39;re submitting over 50 conformers you will have several of these to submit</span>
<span class="c1"># qsub is the command (it means submit to the BlueCrystal queue) then the .qsub file is the file you want to submit</span>
qsub molecule1_OPT_1.qsub
qsub molecule1_OPT_2.qsub
<span class="c1"># ... ... ...</span>
</pre></div>
</div>
</div></blockquote>
<p>Each .qsub file submits 50 (or less) of the Gaussian input files (.com’s) as jobs to run on the computing cluster (BlueCrystal) with a particular walltime, no. processors. Please find out what walltime means.</p>
<p><strong>6</strong> Wait for your calculations to complete…, You can check on their status on grendel (whether queueing/running, job which have finished will disappear)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#To check on status of your calculations type</span>
qstat -nu &lt;username&gt; -t
<span class="c1"># example username is sj18703 it&#39;d be qstat -nu sj18703 -t</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>7</strong> Run move_complete.py to sort your calculations into successes (they’ll be moved to a folder called optlog) and fails (failed folder)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/move_complete.py
</pre></div>
</div>
</div></blockquote>
<p><strong>8</strong> Create Gaussian NMR input files by running opt_to_nmr.py. This will also create a file called ‘population_information.txt’ containing conformer energies and populations</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/opt_to_nmr.py
</pre></div>
</div>
</div></blockquote>
<p>This will produce an nmrcom folder filled with .com files and .qsub file(‘s) similar to before.
There will be a redundant conformer elimination (with the threshold you’ve specified in ENRICH.prefs) to see if any of the structures you have optimised from your .xyz file have converged to the same conformer (Note: Conformers are energy minima, you submitted energy minima based off of molecular mechanics, these are not be minima by DFT, you have submitted .xyz files with are molecular mechanics conformers as (hopefully) good start points for finding DFT conformers [for a particular basis set, functional, grid etc.]). You should open the .xyz file produced in the new ‘OUTPUT’ folder (ideally in Maestro) to check the threshold is appropriate and that we’ve actually removed all duplicates and not just very similar conformers, you should adjust the threshold accordingly.</p>
<p>This will produce an nmrcom folder filled with .com files and .qsub file(‘s) just like optimisation did</p>
<p><strong>9</strong> Submit job files for NMR parameter calculation</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>qsub molecule1_NMR_0.qsub
<span class="c1">#If you&#39;re submitting over 50 conformers you will have several of these to submitting</span>
<span class="c1"># qsub is the command (it means submit to the BlueCrystal queue) then the .qsub file is the file you want to submit</span>
qsub molecule1_NMR_1.qsub
qsub molecule1_NMR_2.qsub
<span class="c1"># ... ... ...</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>10</strong> Wait for the calculations to complete…</p>
<p><strong>11</strong> Run move_complete.py to sort your calculations into successes (they’ll be moved to a folder called nmrlog) and fails (failed folder)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/move_complete.py
</pre></div>
</div>
</div></blockquote>
<p><strong>12</strong> Run nmr_process.py to get the raw DFT NMR experimental measurables out, this will be numbered based on atoms in the .xyz file and assumes all atoms inequivalent on NMR timescale (doesn’t deal with methyls/symmetry). This will produce an OUTPUT folder with the .xyz files for all your DFT geometry optimised conformers</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/nmr_process.py
</pre></div>
</div>
</div></blockquote>
<p><strong>13</strong> Produce equivalency file: Open one of the conformers from your original input .xyz in Maestro (or PyMol or any xyz viewer), In the sidebar go to H - everything then S - sticks and then L - atom identifiers - ID. While in your molecules folder make a file called “Groups.txt” and make list of “your own label” - numbers of atoms that are equivalent (eg H’s on methyl groups) .</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is how you&#39;d make the .txt file using vim on BlueCrystal, but using Window notepad (on your own computer, not on BlueCrystal side) is fine</span>
vim Groups.txt

<span class="c1"># Input all the equivalency eg</span>
<span class="c1"># H1 - 72,73,74 (No blank lines at the end please)</span>

<span class="o">(</span>Esc key<span class="o">)</span>
:wq
<span class="c1"># save and close file</span>
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="_images/equiv.png" src="_images/equiv.png" />
<p class="caption"><span class="caption-text">Format for doing equivalency maths, note this molecule has C<sub>2</sub> symmetry so has funky numbering</span></p>
</div>
</div></blockquote>
<p><strong>14</strong> Run nmr_process.py with equivalency file by specifying equiv as an argument. This will produce two more files in OUTPUT ending in _equiv.txt and _equiv_pretty.txt, The pretty one will show various J couplings &gt; 0.5 Hz and NOEs.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/nmr_process.py equiv
</pre></div>
</div>
</div></blockquote>
<p><strong>Epilogue</strong> Deal with the failures in the failed folder by resubmitting them manually, talk to someone with more experience + read FAQ</p>
</div>
<div class="section" id="install-on-grendel">
<span id="install-grendel"></span><h2>Install on Grendel<a class="headerlink" href="#install-on-grendel" title="Permalink to this headline">¶</a></h2>
<p>This is very similar to installing on BlueCrystal but with some slight differences</p>
<p><strong>1</strong> Get read access to this repository (email <a class="reference external" href="mailto:will&#46;gerrard&#37;&#52;&#48;bristol&#46;ac&#46;uk">will<span>&#46;</span>gerrard<span>&#64;</span>bristol<span>&#46;</span>ac<span>&#46;</span>uk</a> with your github account details or request access through github)</p>
<p><strong>2</strong> Set up your environment:</p>
<blockquote>
<div><p><strong>2.0</strong> Log in to grendel and move to your home directory</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
<span class="c1"># This moves you to your home directory</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1</strong> Install miniconda</p>
<blockquote>
<div><p><strong>2.1.1</strong> Downloading this <a class="reference external" href="https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh/">installer</a></p>
<p><strong>2.1.2</strong> Move install file to grendel using WinSCP (or Cyberduck if on a Mac) to your home directory (the folder you’re in when you log in). Help can be found <a class="reference external" href="https://www.bristol.ac.uk//it-services/locations/fits/science/chemistry/filestore.html/">here</a> for WinSCP</p>
<p><strong>2.1.3</strong> Log in to grendel (through PuTTY on Windows or terminal on Mac). Help can be found <a class="reference external" href="http://www.chm.bris.ac.uk/compres/ssh.html/">here</a></p>
<p><strong>2.1.4</strong> Run the installer and then enter yes for all questions</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash Miniconda2-latest-Linux-x86_64.sh
<span class="c1"># questions pop up, say yes to all</span>
yes
yes
yes
<span class="c1"># yes ..., til it&#39;s all over</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>2.2</strong> Create a conda environment</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create --name myenv
</pre></div>
</div>
</div></blockquote>
<p><strong>2.3</strong> Install openbabel and numpy</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install -c openbabel -n myenv openbabel
conda install -n myenv numpy scipy
</pre></div>
</div>
</div></blockquote>
<p><strong>2.4</strong> Activate the environment you just made, this should put add “(myenv)” to the far left of where you input Commands</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> activate myenv
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>3</strong> Set up Github and get a copy of auto-ENRICH:</p>
<blockquote>
<div><p><strong>3.1</strong> Find your ssh key, we do this by first going to your home folder in grendel then opening .ssh/id_rsa.pub (a text file) containing your key</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim .ssh/id_rsa.pub
</pre></div>
</div>
<div class="figure" id="id7">
<img alt="_images/sshkey.png" src="_images/sshkey.png" />
<p class="caption"><span class="caption-text">Example ssh key</span></p>
</div>
</div></blockquote>
<p><strong>3.2</strong> Copy the key (all that text) then type :q! to exit</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>:q!
<span class="c1"># Close file</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3</strong> Login to Github.com then go to Settings - SSH and GPG keys - New SSH key and paste the key and give it a simple title like Grendel</p>
<blockquote>
<div><div class="figure" id="id8">
<img alt="_images/ssh_github.png" src="_images/ssh_github.png" />
<p class="caption"><span class="caption-text">Navigate through github.com to input ssh key</span></p>
</div>
</div></blockquote>
<p><strong>3.4</strong> Copy auto-ENRICH files, it’ll make a folder called auto-ENRICH containing all the files</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recurse-submodules -b release_1 git@github.com:wg12385/auto-ENRICH.git
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><strong>4</strong> Automatically set up things so when you log in to be able to run auto-ENRICH. If you don’t want to do this type the commands in step <strong>4.2</strong> into your terminal everytime you want to run auto-ENRICH</p>
<blockquote>
<div><p><strong>4.1</strong> Open .bashrc, this is a script that runs automatically when you log in to grendel</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim .bashrc
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2</strong> Tell grendel to automatically load python and git and then activate your conda environment.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> activate myenv
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="run-on-grendel">
<h2>Run on Grendel<a class="headerlink" href="#run-on-grendel" title="Permalink to this headline">¶</a></h2>
<p>auto-ENRICH automates moving from a conformational search output to getting out NMR parameters. Save the output of your conformational search to one .xyz file (that contains lots of conformers) for a particular molecule</p>
<p><strong>1</strong> Make a folder with the molecule name and put your .xyz file in it, cd into that folder</p>
<p><strong>2</strong> Copy the preferences file from the auto-ENRICH folder then open it and decide what you want to run. If the auto-ENRICH folder is 2 directories above your molecules folder (which you are now in) type:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp -rf ~/auto-ENRICH/ENRICH.prefs ./
<span class="c1">#The cp means copy, first place is where it&#39;s copying from,</span>
<span class="c1">#the other is where its copying to, your current directory</span>
<span class="c1">#This applies for all that follows</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3</strong> Edit the preferences (for this particular molecules DFT), if you want to run all your calculations in a specific way then we suggest you edit ENRICH.prefs in the auto-ENRICH to your own personal preferences to save time in future</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim ENRICH.prefs
<span class="c1"># Press the i key then edit the file</span>
:wq
<span class="c1"># Save and then close the file</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4</strong> Create geometry optimisation and frequency correction input files for Gaussian based on your choices in ENRICH.prefs by running xyz_to_opt.py script from the folder containing your .xyz file</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/xyz_to_opt.py
</pre></div>
</div>
</div></blockquote>
<p>This will produce an optcom folder filled with .com files and .qsub file(‘s)</p>
<p><strong>5</strong> Submit job files for optimisation and frequency correction (conformer relative energies)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash molecule1_OPT_0.qsub
<span class="c1">#If you&#39;re submitting over 50 conformers you will have several of these to submitting</span>
bash molecule1_OPT_1.qsub
bash molecule1_OPT_2.qsub
<span class="c1"># ... ... ...</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>6</strong> Wait for your calculations to complete…, You can check on their status on grendel (whether queueing/running, job which have finished will disappear)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#To check on status of your calculations type</span>
qstat -nu &lt;username&gt; -t
<span class="c1"># example username is sj18703</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>7</strong> Run move_complete.py to sort your calculations into successes (they’ll be moved to a folder called optlog) and fails (failed folder)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/move_complete.py
</pre></div>
</div>
</div></blockquote>
<p><strong>8</strong> Create NMR input files by running opt_to_nmr.py. This will also create a file called ‘population.txt’ containing conformer energies</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/opt_to_nmr.py
</pre></div>
</div>
</div></blockquote>
<p>This will produce an nmrcom folder filled with .com files and .qsub file(‘s)
There will be a redundant conformer elimination (with the threshold you’ve specified in ENRICH.prefs) to see if any of the structures you have optimised from your .xyz file have converged to the same conformer (Note: Conformers are energy minima, you submitted energy minima based off of molecular mechanics, these are not be minima by DFT, you have submitted .xyz files with are molecular mechanics conformers as (hopefully) good start points for finding DFT conformers [for a particular basis set, functional, grid etc.]). You should open the .xyz file produced in the new ‘OUTPUT’ folder (ideally in Maestro) to check the threshold is appropriate and that we’ve actually removed all duplicates and not just very similar conformers, you should adjust the threshold accordingly.</p>
<p><strong>9</strong> Submit job files for NMR parameter calculation</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash molecule1_NMR_0.qsub
<span class="c1">#If you&#39;re submitting over 50 conformers you will have several of these to submitting</span>
bash molecule1_NMR_1.qsub
bash molecule1_NMR_2.qsub
<span class="c1"># ... ... ...</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>10</strong> Wait for the calculations to complete…</p>
<p><strong>11</strong> Run move_complete.py to sort your calculations into successes (they’ll be moved to a folder called nmrlog) and fails (failed folder)</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/move_complete.py
</pre></div>
</div>
</div></blockquote>
<p><strong>12</strong> Run nmr_process.py to get the raw DFT NMR experimental measurables out, this will be numbered based on atoms in the .xyz file and assumes all atoms inequivalent on NMR timescale (doesn’t deal with methyls/symmetry). This will produce an OUTPUT folder with the .xyz files for all your DFT geometry optimised conformers</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/nmr_process.py
</pre></div>
</div>
</div></blockquote>
<p><strong>13</strong> Produce equivalency file: Open one of the conformers from your original input .xyz in PyMol (normally, not in terminal), In the sidebar go to H - everything then S - sticks and then L - atom identifiers - ID. While in your molecules folder make a file called “Groups.txt” and make list of “your own label” - numbers of atoms that are equivalent (eg H’s on methyl groups) .</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is how you&#39;d make the .txt file in terminal, but using notepad is fine</span>
vim Groups.txt
<span class="c1"># Input all the equivalency eg</span>
<span class="c1"># H1 - 72,73,74 (no gaps between numbers and commas)</span>
:wq
<span class="c1"># save and close file</span>
</pre></div>
</div>
<div class="figure" id="id9">
<img alt="_images/equiv.png" src="_images/equiv.png" />
<p class="caption"><span class="caption-text">Format for doing equivalency maths, note this molecule has C<sub>2</sub> symmetry</span></p>
</div>
</div></blockquote>
<p><strong>14</strong> Run nmr_process.py with equivalency file by specifying equiv as an argument. This will produce two more files in OUTPUT ending in _equiv.txt and _equiv_pretty.txt, The pretty one will show various J couplings &gt; 0.5 Hz and NOEs.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ~/auto-ENRICH/RUN/nmr_process.py equiv
</pre></div>
</div>
</div></blockquote>
<p><strong>Epilogue</strong> Deal with the failures in the failed folder by resubmitting them manually, talk to someone with more experience + read FAQ</p>
</div>
<div class="section" id="miscellaneous">
<span id="misc-user-guide"></span><h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="panic-noes-method-to-work-in-tandem-with-auto-enrich">
<h2>PANIC: NOEs method to work in tandem with auto-ENRICH<a class="headerlink" href="#panic-noes-method-to-work-in-tandem-with-auto-enrich" title="Permalink to this headline">¶</a></h2>
<p>I: Irradiated protons, S: Observed protons, <span class="math notranslate nohighlight">\(i\)</span>: Conformer.</p>
<p><span class="math notranslate nohighlight">\(r_{(I_{a}, S_{b})} =\)</span> Distance between irradiated proton <span class="math notranslate nohighlight">\(I_{atom a}\)</span> and observed proton <span class="math notranslate nohighlight">\(S_{atom b}\)</span></p>
<p><span class="math notranslate nohighlight">\(p_{i} =\)</span> Population of conformer <span class="math notranslate nohighlight">\(i\)</span></p>
<p><span class="math notranslate nohighlight">\({n_{I}} =\)</span> Number of different (static) protons positions the irradiated atom interconverts between on NMR timescale, e.g. 3 for Me H’s</p>
<div class="math notranslate nohighlight">
\[r_{eff}(I, S)^{-6} = \frac{1}{n_{I} n_{S}}  \sum_{i, a, b}  r_{(I_{a}, S_{b})}^{-6} * p_{i}\]</div>
<p>For use with the refinement script (not yet completed) to process the NOE data you need to:</p>
<p>Set the integral of the irradiate proton to <span class="math notranslate nohighlight">\({n_{I}} * 1000\)</span></p>
<p>Measure the integral, <span class="math notranslate nohighlight">\(\nu_{raw}\)</span>  to the other protons (Only integrals &gt; 0.5% of 1000 should be recorded as valid due to spin diffusion effects)</p>
<p>The refinement script with divide this number by <span class="math notranslate nohighlight">\(n_{I} n_{S}\)</span> to get a scaled integral <span class="math notranslate nohighlight">\(\nu_{scaled}\)</span>, this should then obey:</p>
<div class="math notranslate nohighlight">
\[(\fraction{r_{eff}(S^{2}, S^{1})}{r_{eff}(reference pair)})^{-6} =  \fraction{\nu_{scaled}(S^{2}, S^{1})}{\nu_{scaled}(reference pair)}\]</div>
</div>
<div class="section" id="faq">
<span id="id3"></span><h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gaussian.html" class="btn btn-neutral float-right" title="Interpreting Gaussian" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to wiki_aE’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Will Gerrard and Ollie Dutton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>